# Nav Stemi

![coverage][coverage_badge]
[![style: very good analysis][very_good_analysis_badge]][very_good_analysis_link]
[![License: MIT][license_badge]][license_link]

Generated by the [Very Good CLI][very_good_cli_link] ü§ñ

EMS Navigation App for critical scenarios

---

## Important

For the app to run, you'll need to update the `flutterfire-config.sh` script to match your android/iOS package names for the dev, stage, and/or prod flavors of your app. Then run:

```sh
./flutterfire-config.sh dev
./flutterfire-config.sh stg
./flutterfire-config.sh prod # currently unset
```

There are three reasons for this:

1. This customization makes it much less likely to accidentally point Android (`google-services.json`) and iOS (`GoogleServiceInfo.plist`) configuration files from one environment (e.g. dev) to another (e.g. stg). This forces each flavor of the app to only look for the Android (`google-services.json`) and iOS (`GoogleServiceInfo.plist`) files that are linked to that specific flavor.
2. You can still run the dev flavor of the app without setting stg or prod above. The `main_staging.dart` and `main_production.dart` files will show errors if their respective `firebase_options_*.dart` files haven't been set, but the app will still run.
3. The downside of pointing one flavor of the app to another accidentally is far too great. Not worth the risk.

## Setting up Environment variables

This application uses locally defined environment variables for Google Maps Flutter, Google Routes Flutter, and Flutter Mapbox Navigation. Those are defined locally for testing purposes. For production, it is highly advisable to use server-side API keys and other means to prevent man-in-the-middle (MITM) attacks. See the links provided by Andrea Bizzotto at the beginning of [this post](https://codewithandrea.com/articles/flutter-api-keys-dart-define-env-files/) for more info. Use of compile-time variables in native platforms is [currently being discussed](https://github.com/flutter/flutter/issues/139289) within the Flutter community.

You'll need to create an `.env` folder, with three files `.env/development.env`, `.env/staging.env`, `.env/production.env`. Each of these .env files will contain the following tokens:

```text
MAPS_API_KEY={your_google_navigation_api_token_here}
FIREBASE_APP_ID={your_firebase_app_id}
DIRECTIONS_API={your_directions_api_token_here}
DISTANCE_MATRIX_API={your_distance_matrix_api_token_here}
ROUTES_API={your_routes_api_token_here}
```

If you don't have an access token established yet -- such as for Google Maps API -- just leave the `{}` field blank for now. Don't include `{` or `}` in the access token.

## Getting Started üöÄ

This project contains 3 flavors:

- development
- staging
- production

To run the desired flavor either use the launch configuration in VSCode/Android Studio or use the following commands:

```sh
# Development
$ flutter run --flavor development --target lib/main_development.dart

# Staging
$ flutter run --flavor staging --target lib/main_staging.dart

# Production
$ flutter run --flavor production --target lib/main_production.dart
```

_\*Nav Stemi works on iOS, Android, Web, and Windows._

---

## Running Tests üß™

To run all unit and widget tests use the following command:

```sh
flutter test --coverage --test-randomize-ordering-seed random
```

To view the generated coverage report you can use [lcov](https://github.com/linux-test-project/lcov).

```sh
# Generate Coverage Report
$ genhtml coverage/lcov.info -o coverage/

# Open Coverage Report
$ open coverage/index.html
```

---

## Working with Translations üåê

This project relies on [flutter_localizations][flutter_localizations_link] and follows the [official internationalization guide for Flutter][internationalization_link].

### Adding Strings

1. To add a new localizable string, open the `app_en.arb` file at `lib/l10n/arb/app_en.arb`.

```arb
{
    "@@locale": "en",
    "counterAppBarTitle": "Counter",
    "@counterAppBarTitle": {
        "description": "Text shown in the AppBar of the Counter Page"
    }
}
```

2. Then add a new key/value and description

```arb
{
    "@@locale": "en",
    "counterAppBarTitle": "Counter",
    "@counterAppBarTitle": {
        "description": "Text shown in the AppBar of the Counter Page"
    },
    "helloWorld": "Hello World",
    "@helloWorld": {
        "description": "Hello World Text"
    }
}
```

3. Use the new string

```dart
import 'package:nav_stemi/l10n/l10n.dart';

@override
Widget build(BuildContext context) {
  final l10n = context.l10n;
  return Text(l10n.helloWorld);
}
```

### Adding Supported Locales

Update the `CFBundleLocalizations` array in the `Info.plist` at `ios/Runner/Info.plist` to include the new locale.

```xml
    ...

    <key>CFBundleLocalizations</key>
 <array>
  <string>en</string>
  <string>es</string>
 </array>

    ...
```

### Adding Translations

1. For each supported locale, add a new ARB file in `lib/l10n/arb`.

```
‚îú‚îÄ‚îÄ l10n
‚îÇ   ‚îú‚îÄ‚îÄ arb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app_en.arb
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app_es.arb
```

2. Add the translated strings to each `.arb` file:

`app_en.arb`

```arb
{
    "@@locale": "en",
    "counterAppBarTitle": "Counter",
    "@counterAppBarTitle": {
        "description": "Text shown in the AppBar of the Counter Page"
    }
}
```

`app_es.arb`

```arb
{
    "@@locale": "es",
    "counterAppBarTitle": "Contador",
    "@counterAppBarTitle": {
        "description": "Texto mostrado en la AppBar de la p√°gina del contador"
    }
}
```

### Generating Translations

To use the latest translations changes, you will need to generate them:

1. Generate localizations for the current project:

```sh
flutter gen-l10n --arb-dir="lib/l10n/arb"
```

Alternatively, run `flutter run` and code generation will take place automatically.

[coverage_badge]: coverage_badge.svg
[flutter_localizations_link]: https://api.flutter.dev/flutter/flutter_localizations/flutter_localizations-library.html
[internationalization_link]: https://flutter.dev/docs/development/accessibility-and-localization/internationalization
[license_badge]: https://img.shields.io/badge/license-MIT-blue.svg
[license_link]: https://opensource.org/licenses/MIT
[very_good_analysis_badge]: https://img.shields.io/badge/style-very_good_analysis-B22C89.svg
[very_good_analysis_link]: https://pub.dev/packages/very_good_analysis
[very_good_cli_link]: https://github.com/VeryGoodOpenSource/very_good_cli
